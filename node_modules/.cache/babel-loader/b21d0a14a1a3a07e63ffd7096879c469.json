{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n  return r;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar ArraySchema =\n/** @class */\nfunction (_super) {\n  __extends(ArraySchema, _super);\n\n  function ArraySchema() {\n    var items = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      items[_i] = arguments[_i];\n    }\n\n    var _this = _super.apply(this, items) || this;\n\n    Object.setPrototypeOf(_this, Object.create(ArraySchema.prototype));\n    Object.defineProperties(_this, {\n      $sorting: {\n        value: undefined,\n        enumerable: false,\n        writable: true\n      },\n      $changes: {\n        value: undefined,\n        enumerable: false,\n        writable: true\n      },\n      onAdd: {\n        value: undefined,\n        enumerable: false,\n        writable: true\n      },\n      onRemove: {\n        value: undefined,\n        enumerable: false,\n        writable: true\n      },\n      onChange: {\n        value: undefined,\n        enumerable: false,\n        writable: true\n      },\n      triggerAll: {\n        value: function () {\n          if (!_this.onAdd) {\n            return;\n          }\n\n          for (var i = 0; i < _this.length; i++) {\n            _this.onAdd(_this[i], i);\n          }\n        }\n      },\n      toJSON: {\n        value: function () {\n          var arr = [];\n\n          for (var i = 0; i < _this.length; i++) {\n            var objAt = _this[i];\n            arr.push(typeof objAt.toJSON === \"function\" ? objAt.toJSON() : objAt);\n          }\n\n          return arr;\n        }\n      },\n      clone: {\n        value: function (isDecoding) {\n          var cloned;\n\n          if (isDecoding) {\n            cloned = ArraySchema.of.apply(ArraySchema, _this);\n            cloned.onAdd = _this.onAdd;\n            cloned.onRemove = _this.onRemove;\n            cloned.onChange = _this.onChange;\n          } else {\n            cloned = new (ArraySchema.bind.apply(ArraySchema, __spreadArrays([void 0], _this.map(function (item) {\n              if (typeof item === \"object\") {\n                return item.clone();\n              } else {\n                return item;\n              }\n            }))))();\n          }\n\n          return cloned;\n        }\n      }\n    });\n    return _this;\n  }\n\n  Object.defineProperty(ArraySchema, Symbol.species, {\n    get: function () {\n      return ArraySchema;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  ArraySchema.prototype.sort = function (compareFn) {\n    this.$sorting = true;\n\n    _super.prototype.sort.call(this, compareFn);\n\n    var changes = Array.from(this.$changes.changes);\n\n    for (var _i = 0, changes_1 = changes; _i < changes_1.length; _i++) {\n      var key = changes_1[_i]; // track index change\n\n      var previousIndex = this.$changes.getIndex(this[key]);\n\n      if (previousIndex !== undefined) {\n        this.$changes.mapIndexChange(this[key], previousIndex);\n      }\n\n      this.$changes.mapIndex(this[key], key);\n    }\n\n    this.$sorting = false;\n    return this;\n  };\n\n  ArraySchema.prototype.filter = function (callbackfn, thisArg) {\n    var filtered = _super.prototype.filter.call(this, callbackfn); // TODO: apply removed items on $changes\n\n\n    filtered.$changes = this.$changes;\n    return filtered;\n  };\n\n  ArraySchema.prototype.splice = function (start, deleteCount) {\n    var insert = [];\n\n    for (var _i = 2; _i < arguments.length; _i++) {\n      insert[_i - 2] = arguments[_i];\n    }\n\n    var removedItems = Array.prototype.splice.apply(this, arguments);\n    var movedItems = Array.prototype.filter.call(this, function (item, idx) {\n      return idx >= start + deleteCount - 1;\n    });\n    removedItems.map(function (removedItem) {\n      var $changes = removedItem && removedItem.$changes; // If the removed item is a schema we need to update it.\n\n      if ($changes) {\n        $changes.parent.deleteIndex(removedItem);\n        delete $changes.parent;\n      }\n    });\n    movedItems.forEach(function (movedItem) {\n      // If the moved item is a schema we need to update it.\n      var $changes = movedItem && movedItem.$changes;\n\n      if ($changes) {\n        // Update current index in parent, so subsequent changes in\n        // this item's properties are correctly reflected.\n        $changes.parentField--;\n      }\n    });\n    return removedItems;\n  };\n\n  return ArraySchema;\n}(Array);\n\nexports.ArraySchema = ArraySchema;","map":{"version":3,"sources":["../../src/types/ArraySchema.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGA,IAAA,WAAA;AAAA;AAAA,UAAA,MAAA,EAAA;AAAwC,EAAA,SAAA,CAAA,WAAA,EAAA,MAAA,CAAA;;AAMpC,WAAA,WAAA,GAAA;AAAa,QAAA,KAAA,GAAA,EAAA;;SAAA,IAAA,EAAA,GAAA,C,EAAA,EAAA,GAAA,SAAA,CAAA,M,EAAA,EAAA,E,EAAa;AAAb,MAAA,KAAA,CAAA,EAAA,CAAA,GAAA,SAAA,CAAA,EAAA,CAAA;;;AAAb,QAAA,KAAA,GAAA,MAAA,CAAA,KAAA,CAAA,IAAA,EACa,KADb,KACkB,IADlB;;AAGI,IAAA,MAAM,CAAC,cAAP,CAAsB,KAAtB,EAA4B,MAAM,CAAC,MAAP,CAAc,WAAW,CAAC,SAA1B,CAA5B;AACA,IAAA,MAAM,CAAC,gBAAP,CAAwB,KAAxB,EAA8B;AAC1B,MAAA,QAAQ,EAAM;AAAE,QAAA,KAAK,EAAE,SAAT;AAAoB,QAAA,UAAU,EAAE,KAAhC;AAAuC,QAAA,QAAQ,EAAE;AAAjD,OADY;AAE1B,MAAA,QAAQ,EAAM;AAAE,QAAA,KAAK,EAAE,SAAT;AAAoB,QAAA,UAAU,EAAE,KAAhC;AAAuC,QAAA,QAAQ,EAAE;AAAjD,OAFY;AAI1B,MAAA,KAAK,EAAS;AAAE,QAAA,KAAK,EAAE,SAAT;AAAoB,QAAA,UAAU,EAAE,KAAhC;AAAuC,QAAA,QAAQ,EAAE;AAAjD,OAJY;AAK1B,MAAA,QAAQ,EAAM;AAAE,QAAA,KAAK,EAAE,SAAT;AAAoB,QAAA,UAAU,EAAE,KAAhC;AAAuC,QAAA,QAAQ,EAAE;AAAjD,OALY;AAM1B,MAAA,QAAQ,EAAM;AAAE,QAAA,KAAK,EAAE,SAAT;AAAoB,QAAA,UAAU,EAAE,KAAhC;AAAuC,QAAA,QAAQ,EAAE;AAAjD,OANY;AAQ1B,MAAA,UAAU,EAAE;AACR,QAAA,KAAK,EAAE,YAAA;AACH,cAAI,CAAC,KAAI,CAAC,KAAV,EAAiB;AACb;AACH;;AAED,eAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,KAAI,CAAC,MAAzB,EAAiC,CAAC,EAAlC,EAAsC;AAClC,YAAA,KAAI,CAAC,KAAL,CAAW,KAAI,CAAC,CAAD,CAAf,EAAoB,CAApB;AACH;AACJ;AATO,OARc;AAoB1B,MAAA,MAAM,EAAE;AACJ,QAAA,KAAK,EAAE,YAAA;AACH,cAAM,GAAG,GAAG,EAAZ;;AACA,eAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,KAAI,CAAC,MAAzB,EAAiC,CAAC,EAAlC,EAAsC;AAClC,gBAAM,KAAK,GAAG,KAAI,CAAC,CAAD,CAAlB;AACA,YAAA,GAAG,CAAC,IAAJ,CACK,OAAQ,KAAK,CAAC,MAAd,KAA0B,UAA3B,GACM,KAAK,CAAC,MAAN,EADN,GAEM,KAHV;AAKH;;AACD,iBAAO,GAAP;AACH;AAZG,OApBkB;AAmC1B,MAAA,KAAK,EAAE;AACH,QAAA,KAAK,EAAE,UAAC,UAAD,EAAqB;AACxB,cAAI,MAAJ;;AAEA,cAAI,UAAJ,EAAgB;AACZ,YAAA,MAAM,GAAG,WAAW,CAAC,EAAZ,CAAc,KAAd,CAAA,WAAA,EAAkB,KAAlB,CAAT;AACA,YAAA,MAAM,CAAC,KAAP,GAAe,KAAI,CAAC,KAApB;AACA,YAAA,MAAM,CAAC,QAAP,GAAkB,KAAI,CAAC,QAAvB;AACA,YAAA,MAAM,CAAC,QAAP,GAAkB,KAAI,CAAC,QAAvB;AAEH,WAND,MAMO;AACH,YAAA,MAAM,GAAA,KAAO,WAAW,CAAA,IAAX,CAAW,KAAX,CAAA,WAAA,EAAW,cAAA,CAAA,CAAA,KAAA,CAAA,CAAA,EAAI,KAAI,CAAC,GAAL,CAAS,UAAA,IAAA,EAAI;AACrC,kBAAI,OAAQ,IAAR,KAAkB,QAAtB,EAAgC;AAC5B,uBAAQ,IAAsB,CAAC,KAAvB,EAAR;AACH,eAFD,MAEO;AACH,uBAAO,IAAP;AACH;AACJ,aAN2B,CAAJ,CAAX,CAAP,GAAN;AAOH;;AAED,iBAAO,MAAP;AACH;AArBE;AAnCmB,KAA9B;;AA2DH;;AAjED,EAAA,MAAA,CAAA,cAAA,CAAW,WAAX,EAAY,MAAM,CAAC,OAAnB,EAA2B;SAA3B,YAAA;AAAqC,aAAO,WAAP;AAAqB,KAA/B;oBAAA;;AAAA,GAA3B;;AAoEA,EAAA,WAAA,CAAA,SAAA,CAAA,IAAA,GAAA,UAAK,SAAL,EAAuC;AACnC,SAAK,QAAL,GAAgB,IAAhB;;AACA,IAAA,MAAA,CAAA,SAAA,CAAM,IAAN,CAAU,IAAV,CAAU,IAAV,EAAW,SAAX;;AAEA,QAAM,OAAO,GAAG,KAAK,CAAC,IAAN,CAAW,KAAK,QAAL,CAAc,OAAzB,CAAhB;;AACA,SAAkB,IAAA,EAAA,GAAA,CAAA,EAAA,SAAA,GAAA,OAAlB,EAAkB,EAAA,GAAA,SAAA,CAAA,MAAlB,EAAkB,EAAA,EAAlB,EAA2B;AAAtB,UAAM,GAAG,GAAA,SAAA,CAAA,EAAA,CAAT,CAAsB,CACvB;;AACA,UAAM,aAAa,GAAG,KAAK,QAAL,CAAc,QAAd,CAAuB,KAAK,GAAL,CAAvB,CAAtB;;AACA,UAAI,aAAa,KAAK,SAAtB,EAAiC;AAC7B,aAAK,QAAL,CAAc,cAAd,CAA6B,KAAK,GAAL,CAA7B,EAAwC,aAAxC;AACH;;AACD,WAAK,QAAL,CAAc,QAAd,CAAuB,KAAK,GAAL,CAAvB,EAAkC,GAAlC;AACH;;AAED,SAAK,QAAL,GAAgB,KAAhB;AACA,WAAO,IAAP;AACH,GAhBD;;AAkBA,EAAA,WAAA,CAAA,SAAA,CAAA,MAAA,GAAA,UAAO,UAAP,EAAqE,OAArE,EAAkF;AAC9E,QAAM,QAAQ,GAAG,MAAA,CAAA,SAAA,CAAM,MAAN,CAAY,IAAZ,CAAY,IAAZ,EAAa,UAAb,CAAjB,CAD8E,CAG9E;;;AACC,IAAA,QAAgB,CAAC,QAAjB,GAA4B,KAAK,QAAjC;AAED,WAAO,QAAP;AACH,GAPD;;AASA,EAAA,WAAA,CAAA,SAAA,CAAA,MAAA,GAAA,UAAO,KAAP,EAAsB,WAAtB,EAA0C;AAAE,QAAA,MAAA,GAAA,EAAA;;SAAA,IAAA,EAAA,GAAA,C,EAAA,EAAA,GAAA,SAAA,CAAA,M,EAAA,EAAA,E,EAAc;AAAd,MAAA,MAAA,CAAA,EAAA,GAAA,CAAA,CAAA,GAAA,SAAA,CAAA,EAAA,CAAA;;;AACxC,QAAM,YAAY,GAAG,KAAK,CAAC,SAAN,CAAgB,MAAhB,CAAuB,KAAvB,CAA6B,IAA7B,EAAmC,SAAnC,CAArB;AACA,QAAM,UAAU,GAAG,KAAK,CAAC,SAAN,CAAgB,MAAhB,CAAuB,IAAvB,CAA4B,IAA5B,EAAkC,UAAC,IAAD,EAAO,GAAP,EAAU;AAC3D,aAAO,GAAG,IAAI,KAAK,GAAG,WAAR,GAAsB,CAApC;AACH,KAFkB,CAAnB;AAIA,IAAA,YAAY,CAAC,GAAb,CAAiB,UAAA,WAAA,EAAW;AACxB,UAAM,QAAQ,GAAG,WAAW,IAAK,WAAmB,CAAC,QAArD,CADwB,CAExB;;AACA,UAAI,QAAJ,EAAc;AACV,QAAA,QAAQ,CAAC,MAAT,CAAgB,WAAhB,CAA4B,WAA5B;AACA,eAAO,QAAQ,CAAC,MAAhB;AACH;AACJ,KAPD;AASA,IAAA,UAAU,CAAC,OAAX,CAAmB,UAAA,SAAA,EAAS;AACxB;AACA,UAAM,QAAQ,GAAG,SAAS,IAAK,SAAiB,CAAC,QAAjD;;AAEA,UAAI,QAAJ,EAAc;AACV;AACA;AACA,QAAA,QAAQ,CAAC,WAAT;AACH;AAEJ,KAVD;AAYA,WAAO,YAAP;AACH,GA5BD;;AAmCJ,SAAA,WAAA;AAAC,CAtID,CAAwC,KAAxC,CAAA;;AAAa,OAAA,CAAA,WAAA,GAAA,WAAA","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ArraySchema = /** @class */ (function (_super) {\n    __extends(ArraySchema, _super);\n    function ArraySchema() {\n        var items = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            items[_i] = arguments[_i];\n        }\n        var _this = _super.apply(this, items) || this;\n        Object.setPrototypeOf(_this, Object.create(ArraySchema.prototype));\n        Object.defineProperties(_this, {\n            $sorting: { value: undefined, enumerable: false, writable: true },\n            $changes: { value: undefined, enumerable: false, writable: true },\n            onAdd: { value: undefined, enumerable: false, writable: true },\n            onRemove: { value: undefined, enumerable: false, writable: true },\n            onChange: { value: undefined, enumerable: false, writable: true },\n            triggerAll: {\n                value: function () {\n                    if (!_this.onAdd) {\n                        return;\n                    }\n                    for (var i = 0; i < _this.length; i++) {\n                        _this.onAdd(_this[i], i);\n                    }\n                }\n            },\n            toJSON: {\n                value: function () {\n                    var arr = [];\n                    for (var i = 0; i < _this.length; i++) {\n                        var objAt = _this[i];\n                        arr.push((typeof (objAt.toJSON) === \"function\")\n                            ? objAt.toJSON()\n                            : objAt);\n                    }\n                    return arr;\n                }\n            },\n            clone: {\n                value: function (isDecoding) {\n                    var cloned;\n                    if (isDecoding) {\n                        cloned = ArraySchema.of.apply(ArraySchema, _this);\n                        cloned.onAdd = _this.onAdd;\n                        cloned.onRemove = _this.onRemove;\n                        cloned.onChange = _this.onChange;\n                    }\n                    else {\n                        cloned = new (ArraySchema.bind.apply(ArraySchema, __spreadArrays([void 0], _this.map(function (item) {\n                            if (typeof (item) === \"object\") {\n                                return item.clone();\n                            }\n                            else {\n                                return item;\n                            }\n                        }))))();\n                    }\n                    return cloned;\n                }\n            }\n        });\n        return _this;\n    }\n    Object.defineProperty(ArraySchema, Symbol.species, {\n        get: function () { return ArraySchema; },\n        enumerable: true,\n        configurable: true\n    });\n    ArraySchema.prototype.sort = function (compareFn) {\n        this.$sorting = true;\n        _super.prototype.sort.call(this, compareFn);\n        var changes = Array.from(this.$changes.changes);\n        for (var _i = 0, changes_1 = changes; _i < changes_1.length; _i++) {\n            var key = changes_1[_i];\n            // track index change\n            var previousIndex = this.$changes.getIndex(this[key]);\n            if (previousIndex !== undefined) {\n                this.$changes.mapIndexChange(this[key], previousIndex);\n            }\n            this.$changes.mapIndex(this[key], key);\n        }\n        this.$sorting = false;\n        return this;\n    };\n    ArraySchema.prototype.filter = function (callbackfn, thisArg) {\n        var filtered = _super.prototype.filter.call(this, callbackfn);\n        // TODO: apply removed items on $changes\n        filtered.$changes = this.$changes;\n        return filtered;\n    };\n    ArraySchema.prototype.splice = function (start, deleteCount) {\n        var insert = [];\n        for (var _i = 2; _i < arguments.length; _i++) {\n            insert[_i - 2] = arguments[_i];\n        }\n        var removedItems = Array.prototype.splice.apply(this, arguments);\n        var movedItems = Array.prototype.filter.call(this, function (item, idx) {\n            return idx >= start + deleteCount - 1;\n        });\n        removedItems.map(function (removedItem) {\n            var $changes = removedItem && removedItem.$changes;\n            // If the removed item is a schema we need to update it.\n            if ($changes) {\n                $changes.parent.deleteIndex(removedItem);\n                delete $changes.parent;\n            }\n        });\n        movedItems.forEach(function (movedItem) {\n            // If the moved item is a schema we need to update it.\n            var $changes = movedItem && movedItem.$changes;\n            if ($changes) {\n                // Update current index in parent, so subsequent changes in\n                // this item's properties are correctly reflected.\n                $changes.parentField--;\n            }\n        });\n        return removedItems;\n    };\n    return ArraySchema;\n}(Array));\nexports.ArraySchema = ArraySchema;\n//# sourceMappingURL=ArraySchema.js.map"]},"metadata":{},"sourceType":"script"}