{"ast":null,"code":"import _objectSpread from \"/Users/bacchus/git/Leap/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nvar _jsxFileName = \"/Users/bacchus/git/Leap/client/src/Leap/Leap.js\";\nimport React, { Component } from 'react';\nimport './css/ui.css'; //import Countdown from 'react-countdown-now';\n\nimport { Winner } from './Leap/Announcements';\nimport { GameBoard } from './Leap/GameBoard';\nimport { cellType } from './game/util.js';\nimport Board from './game/board.js';\nimport { UCT as Bot } from './game/ai.js';\nconst playerOne = 4;\nconst playerTwo = 12;\nvar PLAYERS;\nvar BOARD_SIZE;\nconst CELL_COLORS = [\"gray1\", \"gray2\", \"pink\", \"red\", \"orange\", \"yellow\", \"green\", \"blue\"];\n\nclass Leap extends Component {\n  constructor(props) {\n    super(props);\n    BOARD_SIZE = props.config.size;\n    PLAYERS = {\n      [playerOne]: {\n        class: \"player-one\"\n      },\n      [playerTwo]: {\n        class: \"player-two\"\n      }\n    };\n\n    if (props.config.online) {\n      //  const endpoint = ( window.location.origin + `//:${ props.config.port }` );\n      const gameBoardRecieve = board => {\n        this.setState({\n          board: board,\n          turn: board.player\n        });\n      };\n\n      this.state = {\n        online: true,\n        id: props.gameid,\n        ready: false\n      };\n      this.io = props.io;\n      this.io.on('gameBoardRecieve', board => gameBoardRecieve(board));\n      this.io.on('gameLoad', (user, game) => this.loadGame(user, game));\n      this.io.on('move', game => {//game.\n      });\n    } else {\n      //LOCAL GAME\n      this.firstPlayer = props.config.players[0].first ? playerOne : playerTwo;\n      this.state = {\n        online: false,\n        board: new Board(this.firstPlayer, BOARD_SIZE, 0),\n        // 0 is phaseLayout\n        turn: this.firstPlayer,\n        continuedMove: false,\n        selectedPiece: null,\n        winner: null\n      };\n      PLAYERS = {\n        [playerOne]: _objectSpread({}, props.config.players[0], {\n          class: \"player-one\"\n        }),\n        [playerTwo]: _objectSpread({}, props.config.players[1], {\n          class: \"player-two\"\n        })\n      };\n    }\n  }\n\n  loadGame(user, game) {\n    const isHost = user.name === game.host;\n\n    const initGameState = () => {\n      const firstPlayer = game.isHostFirst ? playerOne : playerTwo;\n      const board = new Board(firstPlayer, BOARD_SIZE, 0);\n      game.board = board;\n      return {\n        online: true,\n        board: board,\n        turn: firstPlayer,\n        continuedMove: false,\n        selectedPiece: null,\n        winner: null,\n        ready: true\n      };\n    }; //if game.board exists, load the game details\n    //if game.invite === user.name, then set user as appropriate player\n\n\n    if (game.board) {\n      //set player\n      if (game.isHostFirst && !game.playerTwo) {\n        game.playerTwo = isHost ? '' : user.name;\n        this.player = playerTwo;\n      } else if (!game.isHostFirst && !game.playerOne) {\n        game.playerOne = isHost ? '' : user.name;\n        this.player = playerOne;\n      }\n\n      this.io.emit('gameSet', game);\n      this.setState({\n        online: true,\n        board: game.board,\n        turn: game.board.player,\n        continuedMove: false,\n        selectedPiece: null,\n        winner: null,\n        ready: true\n      });\n    } else {\n      if (game.isHostFirst) {\n        game.playerOne = game.host;\n        this.player = playerOne;\n      } else {\n        game.playerTwo = game.host;\n        this.player = playerTwo;\n      }\n\n      this.io.emit('gameSet', game);\n      this.setState(initGameState());\n    }\n\n    PLAYERS[playerOne].name = game.playerOne;\n    PLAYERS[playerTwo].name = game.playerTwo;\n  }\n\n  componentDidMount() {\n    if (this.state.online) {\n      this.io.emit('gameEnter', this.state.id);\n      this.io.on('userActive', player => {\n        console.log(`${player.name} has joined as player ${this.player & 8 ? 'PLAYER TWO' : 'PLAYER ONE'}`);\n      });\n    } //Check if first player is bot\n    else if (PLAYERS[this.state.turn].bot) {\n        var ai = Bot(this.state.board, 5000);\n        this.handleMove(ai.from, ai.to);\n      } else this.state.board.getAllMoves(this.state.turn);\n  } //React update method\n\n\n  componentDidUpdate(prevProps, prevState) {\n    //this.state.board.highlightPieceMoves();\n    if (prevState.turn !== this.state.turn) {\n      let board = this.state.board;\n\n      if (!board.getAllMoves(this.state.turn)) {\n        console.log(\"${this.state.turn} has no more moves!\");\n        this.setState({\n          winner: board.switchPlayer()\n        });\n      }\n\n      if (PLAYERS[this.state.turn].bot) setTimeout(() => this.botMove(), 200);\n    } else if (this.state.selectedPiece) {//HIGHLIGHT MOVES\n      //if is a move continuation and Counter hasn't started, start the timer\n      //if (this.state.contined_move) {}\n    }\n  }\n\n  botMove() {\n    var ai = new Bot(this.state.board, 1000);\n    this.handleMove(ai.from, ai.to);\n  }\n\n  selectCell(cell, index) {\n    //If a move is not a continuation, default case,\n    if (!this.state.continuedMove) {\n      if (this.canSelectPiece(cell)) this.setPiece(cell, index);else if (this.state.selectedPiece !== null) this.handleMove(this.state.selectedPiece, index);\n    } else {\n      //if continuation\n      //check if move = true..\n      let board = this.state.board;\n      if (cell & 2) this.handleMove(this.state.selectedPiece, index);else {\n        board.removeHighlight(); //TODO: prompt \"end turn?\" option.\n        //right now, let's just end the turn otherwise\n\n        this.setState({\n          board: board,\n          turn: board.switchPlayer(),\n          continuedMove: false,\n          selectedPiece: null\n        });\n      }\n    }\n  }\n\n  handleMove(from, to) {\n    const board = this.state.board;\n    const pi = board.board[from] >> 5; //Have shake animation effect on piece.\n\n    if (!board.validMove(pi, to)) {\n      console.log(\"Invalid move!\");\n      return;\n    }\n\n    console.log(\"handling move...\"); //debugger;\n    //check if win\n\n    if (board.doMove(from, to)) {\n      this.setState({\n        winner: board.player\n      });\n      return;\n    } //If we can jump or leap, or phase\n\n\n    if (board.continuedMove) {\n      board.highlightMoves(pi);\n      this.setState({\n        board: board,\n        turn: board.player,\n        continuedMove: board.continuedMove,\n        selectedPiece: to\n      });\n    } else {\n      this.io.emit('gameBoardSend', this.state.id, board);\n      this.setState({\n        board: board,\n        turn: board.player,\n        continuedMove: false,\n        selectedPiece: null\n      });\n    }\n  }\n\n  canSelectPiece(cell) {\n    //true if cell contains current player's piece AND current player isn't a bot\n    if (this.state.online) return cell & 4 && (cell & 12) === this.state.turn && !PLAYERS[this.state.turn].bot;else return cell & 4 && (cell & 12) === this.state.turn && this.player === this.state.turn;\n  }\n\n  setPiece(cell, index) {\n    let board = this.state.board,\n        pi = cell >> 5;\n    board.removeHighlight();\n    board.highlightMoves(pi);\n    this.setState({\n      selectedPiece: index\n    }); //console.log(\"selected piece: \" + this.state.board.board[row][col].who);\n  }\n\n  restart() {\n    this.state.board.removeHighlight();\n    this.state.board.clearMoves();\n    this.setState({\n      board: new Board(this.firstPlayer, BOARD_SIZE, 0),\n      continuedMove: false,\n      turn: this.firstPlayer,\n      //TODO\n      selectedPiece: null,\n      winner: null\n    });\n  }\n\n  render() {\n    if (this.state.ready) {\n      const player = PLAYERS[this.state.turn].name;\n      const turn = player ? `Current Player: ${player}` : 'Waiting for player...';\n      return React.createElement(\"div\", {\n        className: \"Leap\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 257\n        },\n        __self: this\n      }, this.state.winner && React.createElement(Winner, {\n        player: this.state.winner,\n        restart: this.restart.bind(this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 258\n        },\n        __self: this\n      }), React.createElement(\"h3\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 259\n        },\n        __self: this\n      }, PLAYERS[this.state.turn].name, React.createElement(\"span\", {\n        className: PLAYERS[this.state.turn].class + \"-token\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 261\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"game-container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 263\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"game-options\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 264\n        },\n        __self: this\n      }), React.createElement(GameBoard, {\n        board: this.state.board,\n        size: BOARD_SIZE,\n        selectedPiece: this.state.selectedPiece,\n        selectCell: this.selectCell.bind(this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 265\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"game-menu\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 269\n        },\n        __self: this\n      })));\n    } else return React.createElement(\"div\", {\n      className: \"Leap\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 273\n      },\n      __self: this\n    }, \"LOADING\");\n  }\n\n}\n/*\n<Countdown date={Date.now() + 10000}\n           intervalDelay={0}\n           precision={3}\n           autoStart={this.state.continuedMove}\n           renderer={d => <div>\n              <span className=\"countdown-s\">{d.seconds}</span>\n              <span className=\"countdown-ms\">:{d.milliseconds}</span>\n           </div>}/>\n*/\n\n/*\nTODO:\nGame description\n\n\"How to Play\":\n-directions\n-tutorial?\n\n- Pieces are draggable and snap to grid\n    (if center of dragging piece is strictly within calc(cell-margin + cell-height/2) on drop, then select cell where piece dropped)\n    disable animations for all but phase and clone moves.\n\n- Make animations\n    If clone, we animate the original piece and newly created piece with cloning animation\n    If phase, piece fades in/out from center to edges on adj phase  and on far phase\n    if piece has caught:\n      If jump,\n        piece does a small hop to the destinationCell\n        captured bursts into little circles and fades away\n      If leap,\n        piece gets sucked into portal, (SVG points all transform to center of adj phase, timing ease-in-out), and pushed out (reverse animation)\n        if captured on adj phase:\n          captured shakes and does first part of phase animation while piece being sucked in, but then comes out as little circles on other side\n        else:\n          captured bursts into little circles and fades away\n    else:\n      piece does small hop to destination cell\n*/\n\n\nexport default Leap;","map":{"version":3,"sources":["/Users/bacchus/git/Leap/client/src/Leap/Leap.js"],"names":["React","Component","Winner","GameBoard","cellType","Board","UCT","Bot","playerOne","playerTwo","PLAYERS","BOARD_SIZE","CELL_COLORS","Leap","constructor","props","config","size","class","online","gameBoardRecieve","board","setState","turn","player","state","id","gameid","ready","io","on","user","game","loadGame","firstPlayer","players","first","continuedMove","selectedPiece","winner","isHost","name","host","initGameState","isHostFirst","emit","componentDidMount","console","log","bot","ai","handleMove","from","to","getAllMoves","componentDidUpdate","prevProps","prevState","switchPlayer","setTimeout","botMove","selectCell","cell","index","canSelectPiece","setPiece","removeHighlight","pi","validMove","doMove","highlightMoves","restart","clearMoves","render","bind"],"mappings":";;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAO,cAAP,C,CACA;;AACA,SAASC,MAAT,QAAuB,sBAAvB;AACA,SAASC,SAAT,QAA0B,kBAA1B;AACA,SAAQC,QAAR,QAAuB,gBAAvB;AACA,OAAOC,KAAP,MAAkB,iBAAlB;AACA,SAAQC,GAAG,IAAIC,GAAf,QAAyB,cAAzB;AACA,MAAMC,SAAS,GAAG,CAAlB;AACA,MAAMC,SAAS,GAAG,EAAlB;AACA,IAAIC,OAAJ;AACA,IAAIC,UAAJ;AAGA,MAAMC,WAAW,GAAG,CAAE,OAAF,EAAW,OAAX,EAAoB,MAApB,EAA4B,KAA5B,EAAmC,QAAnC,EAA6C,QAA7C,EAAuD,OAAvD,EAAgE,MAAhE,CAApB;;AAEA,MAAMC,IAAN,SAAmBZ,SAAnB,CAA6B;AAC3Ba,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;AACAJ,IAAAA,UAAU,GAAGI,KAAK,CAACC,MAAN,CAAaC,IAA1B;AACAP,IAAAA,OAAO,GAAG;AACR,OAACF,SAAD,GAAa;AACXU,QAAAA,KAAK,EAAE;AADI,OADL;AAIR,OAACT,SAAD,GAAa;AACXS,QAAAA,KAAK,EAAE;AADI;AAJL,KAAV;;AASA,QAAGH,KAAK,CAACC,MAAN,CAAaG,MAAhB,EAAwB;AACxB;AACE,YAAMC,gBAAgB,GAAGC,KAAK,IAAI;AAAC,aAAKC,QAAL,CAAc;AAACD,UAAAA,KAAK,EAAEA,KAAR;AAAeE,UAAAA,IAAI,EAAEF,KAAK,CAACG;AAA3B,SAAd;AAAkD,OAArF;;AACA,WAAKC,KAAL,GAAa;AAACN,QAAAA,MAAM,EAAE,IAAT;AAAeO,QAAAA,EAAE,EAAEX,KAAK,CAACY,MAAzB;AAAiCC,QAAAA,KAAK,EAAE;AAAxC,OAAb;AACA,WAAKC,EAAL,GAAUd,KAAK,CAACc,EAAhB;AACA,WAAKA,EAAL,CAAQC,EAAR,CAAW,kBAAX,EAA+BT,KAAK,IAAID,gBAAgB,CAACC,KAAD,CAAxD;AACA,WAAKQ,EAAL,CAAQC,EAAR,CAAW,UAAX,EAAuB,CAACC,IAAD,EAAOC,IAAP,KAAgB,KAAKC,QAAL,CAAcF,IAAd,EAAoBC,IAApB,CAAvC;AAEA,WAAKH,EAAL,CAAQC,EAAR,CAAW,MAAX,EAAmBE,IAAI,IAAI,CACzB;AACD,OAFD;AAID,KAZD,MAYO;AACL;AACA,WAAKE,WAAL,GAAmBnB,KAAK,CAACC,MAAN,CAAamB,OAAb,CAAqB,CAArB,EAAwBC,KAAxB,GAAgC5B,SAAhC,GAA4CC,SAA/D;AACA,WAAKgB,KAAL,GAAa;AACXN,QAAAA,MAAM,EAAE,KADG;AAEXE,QAAAA,KAAK,EAAE,IAAIhB,KAAJ,CAAU,KAAK6B,WAAf,EAA4BvB,UAA5B,EAAwC,CAAxC,CAFI;AAEwC;AACnDY,QAAAA,IAAI,EAAE,KAAKW,WAHA;AAIXG,QAAAA,aAAa,EAAE,KAJJ;AAKXC,QAAAA,aAAa,EAAE,IALJ;AAMXC,QAAAA,MAAM,EAAE;AANG,OAAb;AAQA7B,MAAAA,OAAO,GAAG;AACR,SAACF,SAAD,qBACKO,KAAK,CAACC,MAAN,CAAamB,OAAb,CAAqB,CAArB,CADL;AAEEjB,UAAAA,KAAK,EAAE;AAFT,UADQ;AAKR,SAACT,SAAD,qBACKM,KAAK,CAACC,MAAN,CAAamB,OAAb,CAAqB,CAArB,CADL;AAEEjB,UAAAA,KAAK,EAAE;AAFT;AALQ,OAAV;AAUD;AAEF;;AAEDe,EAAAA,QAAQ,CAAEF,IAAF,EAAQC,IAAR,EAAc;AACpB,UAAMQ,MAAM,GAAGT,IAAI,CAACU,IAAL,KAAcT,IAAI,CAACU,IAAlC;;AAEA,UAAMC,aAAa,GAAG,MAAM;AAC1B,YAAMT,WAAW,GAAGF,IAAI,CAACY,WAAL,GAAmBpC,SAAnB,GAA+BC,SAAnD;AACA,YAAMY,KAAK,GAAG,IAAIhB,KAAJ,CAAU6B,WAAV,EAAuBvB,UAAvB,EAAmC,CAAnC,CAAd;AACAqB,MAAAA,IAAI,CAACX,KAAL,GAAaA,KAAb;AACA,aAAO;AACLF,QAAAA,MAAM,EAAE,IADH;AAELE,QAAAA,KAAK,EAAEA,KAFF;AAGLE,QAAAA,IAAI,EAAEW,WAHD;AAILG,QAAAA,aAAa,EAAE,KAJV;AAKLC,QAAAA,aAAa,EAAE,IALV;AAMLC,QAAAA,MAAM,EAAE,IANH;AAOLX,QAAAA,KAAK,EAAE;AAPF,OAAP;AASD,KAbD,CAHoB,CAiBpB;AACA;;;AACA,QAAII,IAAI,CAACX,KAAT,EAAgB;AAEd;AACA,UAAIW,IAAI,CAACY,WAAL,IAAoB,CAACZ,IAAI,CAACvB,SAA9B,EAAyC;AACvCuB,QAAAA,IAAI,CAACvB,SAAL,GAAiB+B,MAAM,GAAG,EAAH,GAAQT,IAAI,CAACU,IAApC;AACA,aAAKjB,MAAL,GAAcf,SAAd;AACD,OAHD,MAGO,IAAI,CAACuB,IAAI,CAACY,WAAN,IAAqB,CAACZ,IAAI,CAACxB,SAA/B,EAAyC;AAC9CwB,QAAAA,IAAI,CAACxB,SAAL,GAAiBgC,MAAM,GAAG,EAAH,GAAQT,IAAI,CAACU,IAApC;AACA,aAAKjB,MAAL,GAAchB,SAAd;AACD;;AACD,WAAKqB,EAAL,CAAQgB,IAAR,CAAa,SAAb,EAAwBb,IAAxB;AAEA,WAAKV,QAAL,CAAc;AACZH,QAAAA,MAAM,EAAE,IADI;AAEZE,QAAAA,KAAK,EAAEW,IAAI,CAACX,KAFA;AAGZE,QAAAA,IAAI,EAAES,IAAI,CAACX,KAAL,CAAWG,MAHL;AAIZa,QAAAA,aAAa,EAAE,KAJH;AAKZC,QAAAA,aAAa,EAAE,IALH;AAMZC,QAAAA,MAAM,EAAE,IANI;AAOZX,QAAAA,KAAK,EAAE;AAPK,OAAd;AAUD,KAtBD,MAsBO;AAEL,UAAGI,IAAI,CAACY,WAAR,EAAqB;AACnBZ,QAAAA,IAAI,CAACxB,SAAL,GAAiBwB,IAAI,CAACU,IAAtB;AACA,aAAKlB,MAAL,GAAchB,SAAd;AACD,OAHD,MAGO;AACLwB,QAAAA,IAAI,CAACvB,SAAL,GAAiBuB,IAAI,CAACU,IAAtB;AACA,aAAKlB,MAAL,GAAcf,SAAd;AACD;;AACD,WAAKoB,EAAL,CAAQgB,IAAR,CAAa,SAAb,EAAwBb,IAAxB;AACA,WAAKV,QAAL,CAAcqB,aAAa,EAA3B;AACD;;AAEDjC,IAAAA,OAAO,CAACF,SAAD,CAAP,CAAmBiC,IAAnB,GAA0BT,IAAI,CAACxB,SAA/B;AACAE,IAAAA,OAAO,CAACD,SAAD,CAAP,CAAmBgC,IAAnB,GAA0BT,IAAI,CAACvB,SAA/B;AAED;;AAEDqC,EAAAA,iBAAiB,GAAG;AAClB,QAAI,KAAKrB,KAAL,CAAWN,MAAf,EAAwB;AACtB,WAAKU,EAAL,CAAQgB,IAAR,CAAa,WAAb,EAA0B,KAAKpB,KAAL,CAAWC,EAArC;AACA,WAAKG,EAAL,CAAQC,EAAR,CAAW,YAAX,EAA0BN,MAAD,IAAY;AACnCuB,QAAAA,OAAO,CAACC,GAAR,CAAa,GAAExB,MAAM,CAACiB,IAAK,yBAA0B,KAAKjB,MAAL,GAAc,CAAf,GAAoB,YAApB,GAAmC,YAAc,EAArG;AACD,OAFD;AAGD,KALD,CAMA;AANA,SAOK,IAAGd,OAAO,CAAC,KAAKe,KAAL,CAAWF,IAAZ,CAAP,CAAyB0B,GAA5B,EAAiC;AACpC,YAAIC,EAAE,GAAG3C,GAAG,CAAC,KAAKkB,KAAL,CAAWJ,KAAZ,EAAmB,IAAnB,CAAZ;AACA,aAAK8B,UAAL,CAAgBD,EAAE,CAACE,IAAnB,EAAyBF,EAAE,CAACG,EAA5B;AACD,OAHI,MAGE,KAAK5B,KAAL,CAAWJ,KAAX,CAAiBiC,WAAjB,CAA6B,KAAK7B,KAAL,CAAWF,IAAxC;AACR,GAzH0B,CA2H3B;;;AACAgC,EAAAA,kBAAkB,CAACC,SAAD,EAAYC,SAAZ,EAAuB;AACvC;AACA,QAAIA,SAAS,CAAClC,IAAV,KAAmB,KAAKE,KAAL,CAAWF,IAAlC,EAAwC;AACtC,UAAIF,KAAK,GAAG,KAAKI,KAAL,CAAWJ,KAAvB;;AACA,UAAI,CAACA,KAAK,CAACiC,WAAN,CAAkB,KAAK7B,KAAL,CAAWF,IAA7B,CAAL,EAAyC;AACvCwB,QAAAA,OAAO,CAACC,GAAR,CAAY,uCAAZ;AACA,aAAK1B,QAAL,CAAc;AAACiB,UAAAA,MAAM,EAAElB,KAAK,CAACqC,YAAN;AAAT,SAAd;AACD;;AAED,UAAIhD,OAAO,CAAC,KAAKe,KAAL,CAAWF,IAAZ,CAAP,CAAyB0B,GAA7B,EAAkCU,UAAU,CAAG,MAAM,KAAKC,OAAL,EAAT,EAAyB,GAAzB,CAAV;AAEnC,KATD,MASO,IAAI,KAAKnC,KAAL,CAAWa,aAAf,EAA6B,CAClC;AACA;AACA;AACD;AACF;;AAEDsB,EAAAA,OAAO,GAAG;AACN,QAAIV,EAAE,GAAG,IAAI3C,GAAJ,CAAQ,KAAKkB,KAAL,CAAWJ,KAAnB,EAA0B,IAA1B,CAAT;AACC,SAAK8B,UAAL,CAAgBD,EAAE,CAACE,IAAnB,EAAyBF,EAAE,CAACG,EAA5B;AACJ;;AAEDQ,EAAAA,UAAU,CAACC,IAAD,EAAOC,KAAP,EAAc;AACtB;AACA,QAAI,CAAC,KAAKtC,KAAL,CAAWY,aAAhB,EAA+B;AAC7B,UAAI,KAAK2B,cAAL,CAAoBF,IAApB,CAAJ,EAA+B,KAAKG,QAAL,CAAcH,IAAd,EAAoBC,KAApB,EAA/B,KACK,IAAI,KAAKtC,KAAL,CAAWa,aAAX,KAA6B,IAAjC,EAAwC,KAAKa,UAAL,CAAgB,KAAK1B,KAAL,CAAWa,aAA3B,EAA0CyB,KAA1C;AAC9C,KAHD,MAGO;AAAE;AACP;AACA,UAAI1C,KAAK,GAAG,KAAKI,KAAL,CAAWJ,KAAvB;AACA,UAAIyC,IAAI,GAAG,CAAX,EAAc,KAAKX,UAAL,CAAgB,KAAK1B,KAAL,CAAWa,aAA3B,EAA0CyB,KAA1C,EAAd,KACK;AACH1C,QAAAA,KAAK,CAAC6C,eAAN,GADG,CAEH;AACA;;AACA,aAAK5C,QAAL,CAAc;AACZD,UAAAA,KAAK,EAAEA,KADK;AAEZE,UAAAA,IAAI,EAAEF,KAAK,CAACqC,YAAN,EAFM;AAGZrB,UAAAA,aAAa,EAAE,KAHH;AAIZC,UAAAA,aAAa,EAAE;AAJH,SAAd;AAMD;AACF;AACF;;AAEDa,EAAAA,UAAU,CAACC,IAAD,EAAOC,EAAP,EAAW;AACnB,UAAMhC,KAAK,GAAG,KAAKI,KAAL,CAAWJ,KAAzB;AACA,UAAM8C,EAAE,GAAG9C,KAAK,CAACA,KAAN,CAAY+B,IAAZ,KAAqB,CAAhC,CAFmB,CAInB;;AACA,QAAI,CAAC/B,KAAK,CAAC+C,SAAN,CAAgBD,EAAhB,EAAoBd,EAApB,CAAL,EAA8B;AAC5BN,MAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACA;AACD;;AACDD,IAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ,EATmB,CAUnB;AAEA;;AACA,QAAG3B,KAAK,CAACgD,MAAN,CAAajB,IAAb,EAAmBC,EAAnB,CAAH,EAA2B;AACzB,WAAK/B,QAAL,CAAc;AAACiB,QAAAA,MAAM,EAAElB,KAAK,CAACG;AAAf,OAAd;AACA;AACD,KAhBkB,CAkBnB;;;AACA,QAAIH,KAAK,CAACgB,aAAV,EAAyB;AACvBhB,MAAAA,KAAK,CAACiD,cAAN,CAAqBH,EAArB;AACA,WAAK7C,QAAL,CAAc;AACZD,QAAAA,KAAK,EAAEA,KADK;AAEZE,QAAAA,IAAI,EAAEF,KAAK,CAACG,MAFA;AAGZa,QAAAA,aAAa,EAAEhB,KAAK,CAACgB,aAHT;AAIZC,QAAAA,aAAa,EAAEe;AAJH,OAAd;AAMD,KARD,MAQO;AACL,WAAKxB,EAAL,CAAQgB,IAAR,CAAa,eAAb,EAA8B,KAAKpB,KAAL,CAAWC,EAAzC,EAA6CL,KAA7C;AAEA,WAAKC,QAAL,CAAc;AACZD,QAAAA,KAAK,EAAEA,KADK;AAEZE,QAAAA,IAAI,EAAEF,KAAK,CAACG,MAFA;AAGZa,QAAAA,aAAa,EAAE,KAHH;AAIZC,QAAAA,aAAa,EAAE;AAJH,OAAd;AAQD;AAEF;;AAED0B,EAAAA,cAAc,CAACF,IAAD,EAAO;AACnB;AACA,QAAI,KAAKrC,KAAL,CAAWN,MAAf,EAAuB,OAAQ2C,IAAI,GAAG,CAAR,IAAgB,CAACA,IAAI,GAAG,EAAR,MAAgB,KAAKrC,KAAL,CAAWF,IAA3C,IAAqD,CAACb,OAAO,CAAC,KAAKe,KAAL,CAAWF,IAAZ,CAAP,CAAyB0B,GAAtF,CAAvB,KACK,OAAQa,IAAI,GAAG,CAAR,IAAgB,CAACA,IAAI,GAAG,EAAR,MAAgB,KAAKrC,KAAL,CAAWF,IAA3C,IAAsD,KAAKC,MAAL,KAAgB,KAAKC,KAAL,CAAWF,IAAxF;AACN;;AAED0C,EAAAA,QAAQ,CAACH,IAAD,EAAOC,KAAP,EAAc;AACpB,QAAI1C,KAAK,GAAG,KAAKI,KAAL,CAAWJ,KAAvB;AAAA,QAA8B8C,EAAE,GAAGL,IAAI,IAAI,CAA3C;AACAzC,IAAAA,KAAK,CAAC6C,eAAN;AACA7C,IAAAA,KAAK,CAACiD,cAAN,CAAqBH,EAArB;AACA,SAAK7C,QAAL,CAAc;AAACgB,MAAAA,aAAa,EAAEyB;AAAhB,KAAd,EAJoB,CAKlB;AACH;;AAEDQ,EAAAA,OAAO,GAAG;AACR,SAAK9C,KAAL,CAAWJ,KAAX,CAAiB6C,eAAjB;AACA,SAAKzC,KAAL,CAAWJ,KAAX,CAAiBmD,UAAjB;AACA,SAAKlD,QAAL,CAAc;AAAED,MAAAA,KAAK,EAAE,IAAIhB,KAAJ,CAAU,KAAK6B,WAAf,EAA4BvB,UAA5B,EAAwC,CAAxC,CAAT;AACE0B,MAAAA,aAAa,EAAE,KADjB;AACwBd,MAAAA,IAAI,EAAE,KAAKW,WADnC;AACgD;AAC9CI,MAAAA,aAAa,EAAE,IAFjB;AAEuBC,MAAAA,MAAM,EAAE;AAF/B,KAAd;AAGD;;AAEDkC,EAAAA,MAAM,GAAG;AACP,QAAI,KAAKhD,KAAL,CAAWG,KAAf,EAAsB;AACpB,YAAMJ,MAAM,GAAGd,OAAO,CAAC,KAAKe,KAAL,CAAWF,IAAZ,CAAP,CAAyBkB,IAAxC;AACA,YAAMlB,IAAI,GAAGC,MAAM,GAAI,mBAAmBA,MAAQ,EAA/B,GAAmC,uBAAtD;AAEA,aACE;AAAK,QAAA,SAAS,EAAC,MAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,KAAKC,KAAL,CAAWc,MAAX,IAAqB,oBAAC,MAAD;AAAQ,QAAA,MAAM,EAAE,KAAKd,KAAL,CAAWc,MAA3B;AAAmC,QAAA,OAAO,EAAE,KAAKgC,OAAL,CAAaG,IAAb,CAAkB,IAAlB,CAA5C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADzB,EAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACGhE,OAAO,CAAC,KAAKe,KAAL,CAAWF,IAAZ,CAAP,CAAyBkB,IAD5B,EAEE;AAAM,QAAA,SAAS,EAAE/B,OAAO,CAAC,KAAKe,KAAL,CAAWF,IAAZ,CAAP,CAAyBL,KAAzB,GAA+B,QAAhD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFF,CAFF,EAME;AAAK,QAAA,SAAS,EAAC,gBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE;AAAK,QAAA,SAAS,EAAC,cAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,EAEE,oBAAC,SAAD;AAAW,QAAA,KAAK,EAAE,KAAKO,KAAL,CAAWJ,KAA7B;AACW,QAAA,IAAI,EAAEV,UADjB;AAEW,QAAA,aAAa,EAAE,KAAKc,KAAL,CAAWa,aAFrC;AAGW,QAAA,UAAU,EAAE,KAAKuB,UAAL,CAAgBa,IAAhB,CAAqB,IAArB,CAHvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFF,EAME;AAAK,QAAA,SAAS,EAAC,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QANF,CANF,CADF;AAiBD,KArBD,MAqBO,OAAO;AAAK,MAAA,SAAS,EAAC,MAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAP;AACR;;AAjQ0B;AAoQ7B;;;;;;;;;;;AAWA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4BA,eAAe7D,IAAf","sourcesContent":["import React, { Component } from 'react';\nimport './css/ui.css';\n//import Countdown from 'react-countdown-now';\nimport { Winner } from './Leap/Announcements';\nimport { GameBoard } from './Leap/GameBoard';\nimport {cellType} from './game/util.js';\nimport Board from './game/board.js';\nimport {UCT as Bot} from './game/ai.js';\nconst playerOne = 4;\nconst playerTwo = 12;\nvar PLAYERS;\nvar BOARD_SIZE;\n\n\nconst CELL_COLORS = [ \"gray1\", \"gray2\", \"pink\", \"red\", \"orange\", \"yellow\", \"green\", \"blue\"];\n\nclass Leap extends Component {\n  constructor(props) {\n    super(props);\n    BOARD_SIZE = props.config.size;\n    PLAYERS = {\n      [playerOne]: {\n        class: \"player-one\"\n      },\n      [playerTwo]: {\n        class: \"player-two\"\n      }\n    }\n\n    if(props.config.online) {\n    //  const endpoint = ( window.location.origin + `//:${ props.config.port }` );\n      const gameBoardRecieve = board => {this.setState({board: board, turn: board.player})};\n      this.state = {online: true, id: props.gameid, ready: false};\n      this.io = props.io;\n      this.io.on('gameBoardRecieve', board => gameBoardRecieve(board));\n      this.io.on('gameLoad', (user, game) => this.loadGame(user, game));\n\n      this.io.on('move', game => {\n        //game.\n      });\n\n    } else {\n      //LOCAL GAME\n      this.firstPlayer = props.config.players[0].first ? playerOne : playerTwo;\n      this.state = {\n        online: false,\n        board: new Board(this.firstPlayer, BOARD_SIZE, 0), // 0 is phaseLayout\n        turn: this.firstPlayer,\n        continuedMove: false,\n        selectedPiece: null,\n        winner: null\n      };\n      PLAYERS = {\n        [playerOne]: {\n          ...props.config.players[0],\n          class: \"player-one\"\n        },\n        [playerTwo]: {\n          ...props.config.players[1],\n          class: \"player-two\"\n        }\n      }\n    }\n\n  }\n\n  loadGame (user, game) {\n    const isHost = user.name === game.host;\n\n    const initGameState = () => {\n      const firstPlayer = game.isHostFirst ? playerOne : playerTwo;\n      const board = new Board(firstPlayer, BOARD_SIZE, 0);\n      game.board = board;\n      return {\n        online: true,\n        board: board,\n        turn: firstPlayer,\n        continuedMove: false,\n        selectedPiece: null,\n        winner: null,\n        ready: true,\n      };\n    };\n    //if game.board exists, load the game details\n    //if game.invite === user.name, then set user as appropriate player\n    if (game.board) {\n\n      //set player\n      if (game.isHostFirst && !game.playerTwo) {\n        game.playerTwo = isHost ? '' : user.name;\n        this.player = playerTwo;\n      } else if (!game.isHostFirst && !game.playerOne){\n        game.playerOne = isHost ? '' : user.name;\n        this.player = playerOne;\n      }\n      this.io.emit('gameSet', game);\n\n      this.setState({\n        online: true,\n        board: game.board,\n        turn: game.board.player,\n        continuedMove: false,\n        selectedPiece: null,\n        winner: null,\n        ready: true,\n      });\n\n    } else {\n\n      if(game.isHostFirst) {\n        game.playerOne = game.host;\n        this.player = playerOne;\n      } else {\n        game.playerTwo = game.host;\n        this.player = playerTwo;\n      }\n      this.io.emit('gameSet', game);\n      this.setState(initGameState());\n    }\n\n    PLAYERS[playerOne].name = game.playerOne;\n    PLAYERS[playerTwo].name = game.playerTwo;\n\n  }\n\n  componentDidMount() {\n    if( this.state.online ) {\n      this.io.emit('gameEnter', this.state.id);\n      this.io.on('userActive', (player) => {\n        console.log(`${player.name} has joined as player ${ (this.player & 8) ? 'PLAYER TWO' : 'PLAYER ONE' }`);\n      });\n    }\n    //Check if first player is bot\n    else if(PLAYERS[this.state.turn].bot) {\n      var ai = Bot(this.state.board, 5000);\n      this.handleMove(ai.from, ai.to);\n    } else this.state.board.getAllMoves(this.state.turn);\n  }\n\n  //React update method\n  componentDidUpdate(prevProps, prevState) {\n    //this.state.board.highlightPieceMoves();\n    if (prevState.turn !== this.state.turn) {\n      let board = this.state.board;\n      if (!board.getAllMoves(this.state.turn)) {\n        console.log(\"${this.state.turn} has no more moves!\");\n        this.setState({winner: board.switchPlayer()});\n      }\n\n      if (PLAYERS[this.state.turn].bot) setTimeout ( () => this.botMove(), 200 );\n\n    } else if (this.state.selectedPiece){\n      //HIGHLIGHT MOVES\n      //if is a move continuation and Counter hasn't started, start the timer\n      //if (this.state.contined_move) {}\n    }\n  }\n\n  botMove() {\n      var ai = new Bot(this.state.board, 1000);\n       this.handleMove(ai.from, ai.to);\n  }\n\n  selectCell(cell, index) {\n    //If a move is not a continuation, default case,\n    if (!this.state.continuedMove) {\n      if (this.canSelectPiece(cell)) this.setPiece(cell, index);\n      else if (this.state.selectedPiece !== null)  this.handleMove(this.state.selectedPiece, index);\n    } else { //if continuation\n      //check if move = true..\n      let board = this.state.board;\n      if (cell & 2) this.handleMove(this.state.selectedPiece, index);\n      else {\n        board.removeHighlight();\n        //TODO: prompt \"end turn?\" option.\n        //right now, let's just end the turn otherwise\n        this.setState({\n          board: board,\n          turn: board.switchPlayer(),\n          continuedMove: false,\n          selectedPiece: null\n        });\n      }\n    }\n  }\n\n  handleMove(from, to) {\n    const board = this.state.board;\n    const pi = board.board[from] >> 5;\n\n    //Have shake animation effect on piece.\n    if (!board.validMove(pi, to)) {\n      console.log(\"Invalid move!\");\n      return;\n    }\n    console.log(\"handling move...\");\n    //debugger;\n\n    //check if win\n    if(board.doMove(from, to)) {\n      this.setState({winner: board.player});\n      return;\n    }\n\n    //If we can jump or leap, or phase\n    if (board.continuedMove) {\n      board.highlightMoves(pi);\n      this.setState({\n        board: board,\n        turn: board.player,\n        continuedMove: board.continuedMove,\n        selectedPiece: to\n      });\n    } else {\n      this.io.emit('gameBoardSend', this.state.id, board);\n\n      this.setState({\n        board: board,\n        turn: board.player,\n        continuedMove: false,\n        selectedPiece: null\n      });\n\n\n    }\n\n  }\n\n  canSelectPiece(cell) {\n    //true if cell contains current player's piece AND current player isn't a bot\n    if (this.state.online) return (cell & 4) && ( (cell & 12) === this.state.turn ) && !PLAYERS[this.state.turn].bot;\n    else return (cell & 4) && ( (cell & 12) === this.state.turn ) && (this.player === this.state.turn);\n  }\n\n  setPiece(cell, index) {\n    let board = this.state.board, pi = cell >> 5;\n    board.removeHighlight();\n    board.highlightMoves(pi);\n    this.setState({selectedPiece: index});\n      //console.log(\"selected piece: \" + this.state.board.board[row][col].who);\n  }\n\n  restart() {\n    this.state.board.removeHighlight();\n    this.state.board.clearMoves();\n    this.setState({ board: new Board(this.firstPlayer, BOARD_SIZE, 0),\n                    continuedMove: false, turn: this.firstPlayer, //TODO\n                    selectedPiece: null, winner: null });\n  }\n\n  render() {\n    if (this.state.ready) {\n      const player = PLAYERS[this.state.turn].name;\n      const turn = player ? `Current Player: ${ player }` : 'Waiting for player...' ;\n\n      return (\n        <div className=\"Leap\">\n          { this.state.winner && <Winner player={this.state.winner} restart={this.restart.bind(this)} /> }\n          <h3>\n            {PLAYERS[this.state.turn].name}\n            <span className={PLAYERS[this.state.turn].class+\"-token\"}></span>\n          </h3>\n          <div className=\"game-container\">\n            <div className=\"game-options\"></div>\n            <GameBoard board={this.state.board}\n                       size={BOARD_SIZE}\n                       selectedPiece={this.state.selectedPiece}\n                       selectCell={this.selectCell.bind(this)} />\n            <div className=\"game-menu\"></div>\n          </div>\n        </div>\n      );\n    } else return <div className=\"Leap\">LOADING</div>;\n  }\n}\n\n/*\n<Countdown date={Date.now() + 10000}\n           intervalDelay={0}\n           precision={3}\n           autoStart={this.state.continuedMove}\n           renderer={d => <div>\n              <span className=\"countdown-s\">{d.seconds}</span>\n              <span className=\"countdown-ms\">:{d.milliseconds}</span>\n           </div>}/>\n*/\n\n/*\nTODO:\nGame description\n\n\"How to Play\":\n-directions\n-tutorial?\n\n- Pieces are draggable and snap to grid\n    (if center of dragging piece is strictly within calc(cell-margin + cell-height/2) on drop, then select cell where piece dropped)\n    disable animations for all but phase and clone moves.\n\n- Make animations\n    If clone, we animate the original piece and newly created piece with cloning animation\n    If phase, piece fades in/out from center to edges on adj phase  and on far phase\n    if piece has caught:\n      If jump,\n        piece does a small hop to the destinationCell\n        captured bursts into little circles and fades away\n      If leap,\n        piece gets sucked into portal, (SVG points all transform to center of adj phase, timing ease-in-out), and pushed out (reverse animation)\n        if captured on adj phase:\n          captured shakes and does first part of phase animation while piece being sucked in, but then comes out as little circles on other side\n        else:\n          captured bursts into little circles and fades away\n    else:\n      piece does small hop to destination cell\n*/\nexport default Leap;\n"]},"metadata":{},"sourceType":"module"}